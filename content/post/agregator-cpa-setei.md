+++
date = "2018-12-30"
title = "Агрегатор CPA сетей"
slug = "agregator-cpa-setei"
categories = [ "Разработка" ]
tags = [ "CPA", "Golang", "Admitad" ]
draft = true
+++

CPA расшифровывается как Cost Per Action -- плата за действие: регистрацию на сайте, подписку на новости, пополнение счета и так далее. Такие действия называются конверсиями.

СPA сеть работает как посредник между рекламодателем и площадками. Пользователь переходит по ссылкам, которые предоставляет сеть. Учитываются переходы, совершённые конверсии, владельцам площадок начисляются деньги. CPA сеть берет на себя часть работы. CPA сеть берет на себя часть работы, связанную с учетом статистики и оплаты.

![](/img/cpa/cpa.png?c=1)

Рекламодателям выгодно работать по CPA схеме. Результат показов и кликов измеряется только через некоторое время. С конверсиями результат видно сразу. Например, пользователь пополнил счет в онлайн казино, тогда владелец площадки, с которой пришел пользователь, получает за это деньги.

Владельцам площадок хочется заработать побольше денег. Для этого подбираются дорогие офферы, которые конвертят. В разных сетях есть разные конвертящие офферы. Давайте научимся объединять CPA сети и выбирать офферы сразу из нескольких.

Для автоматизации нужны CPA сети с которыми возможна работа через API. Таких сетей не много. Наше приложение будет работать с тремя:

* [Admitad](https://developers.admitad.com/ru/doc/webmaster-api/)
* [Сityads](https://cityads.com/api/dev/interface/rest?lang=ru)
* [Где слон?](https://www.gdeslon.ru/api_settings/xml)

Это не все возможные сети, их десятки. Но у этих вменяемые API с которыми получится интегрироваться. Если вы знаете подходящие сети для интегрирования, напишите мне.

Для этих CPA сетей напишем библиотеки на языке программирования Go.

<h2 id="admitad"><a href="#admitad">Admitad</a></h2>

Характеристики:

- Онлайн статистика
- Выплаты каждую неделю по четвергам
- Выплаты через: банк, банковская карта, PayPal, WebMoney, epayments.
- Минимальная сумма для вывода средств: 300 руб

Для работы нужен список площадок, офферов и баннеров. Нужна статистика по конверсиям. Все это доступно через API Admitad. Методов много, подробно почитать о API можно на [странице для разработчиков](https://developers.admitad.com/ru/doc/api_ru/methods/methods-index/).

> Кампании в терминологии CPA сетей называются офферами или предложениями. В интерфейсе Admitad офферы называются программами. Офферы -- термин, который используется большинством сетей, будем использовать везде, где это уместно.

Первым шагом делаем авторизацию. На [специальной страничке](https://www.admitad.com/ru/webmaster/account/settings/credentials/) получаем идентификатор клиента и ключ для доступа к API.

![](/img/cpa/admitad.png)

Нас интересуют поля `client_id` и `base64_header`. Эти поля используем для получения токена. 

Главной частью библиотеки будет структура `Client`.

```go
var (
    base64Header = "xxx"
    clientId = "xxx"
)

client := NewClient(
    "https://api.admitad.com",
    base64Header,
    clientId,
    []string{"advcampaigns", "banners", "websites", "advcampaigns_for_website", "banners_for_website"},
)

token, err := client.Token()
if err != nil {
    return nil, err
}
client.Init(token)
```
Теперь есть возможность получить список баннеров с помощью методов библиотеки. Полный код библиотеки для работы с Admitad API [выложен на GitHub](https://github.com/horechek/admitad)

<h2 id="cityads"><a href="#cityads">Cityads</a></h2>

Характеристики:

- Хорошая система онлайн статистики
- Выплаты 2 раза в месяц
- Выплаты через: Webmoney, Яндекс.Деньги, PayPal, карты VISA/MasterCard и Capitalist, банковский счет
- Минимальная сумма для вывода средств: 2000 руб

Cityads - еще одна CPA сеть. У этой сети API не уступает Admitad. Документации по API много и она доступна в специальном [разделе для разработчиков](https://cityads.com/api/dev/auth?lang=ru).

Начнем с авторизации. Доступы получаем на [специальной страничке](https://cityads.com/ru/webmaster/office/api). Нас интересует поле `remote_auth`.
 
![cityads](/img/cpa/cityads.png)

Авторизация работает или по OAuth, или с использованием `remote_auth`, который получили на сайте. Доступ к API с помощью `remote_auth` проще чем поддержка OAuth, поэтому будем использовать такой подход.

В структуре клиента только три поля.

```go
client := cityads.NewClient(
    "https://cityads.com/api/rest/webmaster/json",
    "xxx",
)
```

`xxx` - как раз тот самый `remote_auth`

С помощью библиотеки получаем список баннеров. Полный код библиотеки для работы с Сityads API [выложен на GitHub](https://github.com/horechek/cityads)

<h2 id="gdeslon"><a href="#gdeslon">Где Слон?</a></h2>

Характеристики:

- Минимальная онлайн статистика
- Выплаты через: Webmoney, банковскую карту, Яндекс.Деньги, QIWI или карты Payonee
- Минимальная выплата 500 руб.

Наш третий кандидат - партнерская сеть "Где Слон?". У этой партнерской сети API проще чем у Admitad и Citiads. Оффера подбираются по ключевым словам. Вместо многостраничной документации -всего [одна страница документации](https://www.gdeslon.ru/api_settings/xml) и два метода. Ключ для доступа к API тоже на этой странице.

![gdeslon](/img/cpa/gdeslon.png)

Создаем экземпляр клиента:

```go
client := gdeslon.NewClient(
    "https://api.gdeslon.ru/api",
    "xxx",
)
```

`xxx` - это ключ доступа

Важное замечание: в "Где Слон?" оффера подбираются по ключевым словам. 

Полный код библиотеки для работы с "Где Слон?" API [выложен на GitHub](https://github.com/horechek/gdeslon)

<h2 id="spaceship"><a href="#spaceship">Строим космический корабль</a></h2>

Составные части космического корабля:

 - Нетворки как плагины
 - Загрузка офферов в едином формате
 - Выставление весов офферам
 - Отдача рекламы