+++
date = "2019-03-11"
title = "Кроспостинг из вк в телеграм"
categories = [ "Скрипты" ]
tags = [ "соцсети", "вконтакте", "телеграм" ]
draft = true

[image]
  caption = "Изображение: Pixel Privacy"
  focal_point = "Smart"
  preview_only = false
+++

Мне приходится вести несколько групп в ВК и каналов в Телеграм. Часть пользователей больше любит телегу, а часть читает новости в ВК. Поэтому одни и те же новости я пощу и туда и туда. Это лишняя работа, от которой хочется избавится. 

В ВК есть отложенный постинг и Callback API. Нужен инструмент, который будет переносить статьи из ВК в телеграм канал. Это не сложная задача. Наверняка есть множество инструментов, которые уже решают эту проблему.

## [PosterBot](https://posterbot.co)

PosterBot был запущен в конце декабря 2016 года. Это бот, который отправляет новые записи из «ВКонтакте», Instagram, Twitter, RSS, Tumblr и Youtube в частные и публичные каналы Telegram со всеми вложениями.

В настройках каналов можно фильтровать рекламные записи, добавлять лайки к каждому сообщению, настраивать время между записями, использовать своего бота для отправки и многое другое. Сообщения отправляются всем пользователям мгновенно — сразу после их появления в социальных сетях и RSS.

Есть бесплатная версия с ограничениями и платная.

## [re_postBot](https://t.me/re_postbot)

У этого бота тоже куча настроек. Он может репостит все виды постов, в том числе и аудиотреки. Посты со множеством картинок репостятся медиагруппой. Пост-опрос из VK в канале имеет интерактив - можно отвечать уже в канале. Настройка времени задержки в канале между постами. Источники: группы ВКонтакте (VK), Instagram, Twitter.

## Свой вариант

Это все замечательные инструменты, но меня не устраивает их сложность. Хочу чтобы все было просто, понятно и с открытым исходным кодом.  Существует проект [VK to Telegram auto-posting Bot](https://github.com/lgg/vk-to-telegram-bot).  Но он написан на PHP и все настройки только через конфиг. Будем писать свой сервис на Go.

Будем использовать Callback API. Это удобный способ для получения уведомлений о новых поcтах в группе. В настройках нужно указать какой URL будет вызываться:

![](/img/teleport/Untitled-72f09865-e94e-4221-852b-463b87590498.png)

В нашем нужно реализовать хендлер, на который будут приходить вызовы от серверов ВК.

Постить в телеграм будем через Telegram API. Нужно создать отдельного бота, добавить его в канал и сделать администратором.

Новый бот создается с помощью BotFather.

![](/img/teleport/Untitled-c08a75df-2663-4e6b-9b2a-d6cdb7845b71.png)

Выбираем имя для бота

![](Untitled-0dad3f5c-8e9c-48cc-97fe-128302372c39.png)

Нам нужен токен, который позволит постить в Телеграм. 

Теперь добавляем нашего нового бота в канал:

![](/img/teleport/Untitled-13629d1d-5340-4791-a03f-d9710ba2f45e.png)

![](/img/teleport/Untitled-00c02ad2-a788-4fa3-aac2-bcf4d50507ea.png)

## [Teleport](https://github.com/horechek/teleport)

В итоге получился сервис с открытым исходным кодом - [Teleport](https://github.com/horechek/teleport).

![](/img/teleport/Untitled-597be5f5-c5fb-4b44-b1df-789c36507cd5.png)

Для добавления нового канала и новой группы заполняем форму:

![](/img/teleport/Untitled-18fde926-35cf-4fdc-856b-ecacfed7f204.png)

- **Заголовок** - заполняем как хотим, лучше всего написать название сообщества.
- **Токен** - это маркер, который вы получили при создании телеграм бота. Например: 926000356:AAE8VatoXTPkPVM-2Sf4vhum_2UBl5JFE2c
- **Канал** - название вашего канала с @ в начале, например @adtech
- **Секрет** - строка, которую должен вернуть сервер при вызове из  Callback API. Эта строка указана на странице настроек группы

Это селф-хостетд сервис, который можно поднять на любом VPS сервере. Есть готовый Docker образ и запустить сервис можно одной строчкой. Но сначала добавим нового пользователя:

```
docker run -p 8080:8080 -v $(pwd)/data:/data horechek/teleport teleport -database=/data/teleport.db users add --email=test@gmail.com --pass=123
```

Теперь можно запускать сам сервис:

```
docker run -p 8080:8080 -v $(pwd)/data:/data horechek/teleport teleport -database=/data/teleport.db server
```

Переходим по адресу [http://localhost:4200](http://localhost:4200/) в браузере и видим форму авторизации. Нужно указать емейл и пароль которые использовались при добавлении нового пользователя(--email=test@gmail.com --pass=123)

Для настроек используется база SQLIite, все данные будут храниться в отдельном файле.